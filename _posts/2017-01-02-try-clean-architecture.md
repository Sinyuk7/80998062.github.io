---
layout:     post
title:      "ä¸€åªå°å®‰å“çš„Cleanæ¶æ„å®è·µä»¥åŠå¹´ç»ˆæ€»ç»“"
subtitle:   "æ–°å¹´å¿«ä¹å•¦"
date:       2017-01-02
author:     "Sinyuk"
header-img: "img/in-post/å¹´ç»ˆæ€»ç»“/bojack.jpg"
tags:
    - Architecture
    - Android
---



# ä¸€åªå°å®‰å“çš„Cleanæ¶æ„å®è·µä»¥åŠå¹´ç»ˆæ€»ç»“



## å‰è¨€

ä»è‡ªå­¦å®‰å“åˆ°æ¯•ä¸šğŸ“ç„¶åå·¥ä½œå·²ç»å¿«ä¸€å¹´å¤šäº†å§

è¿™ä¸€å¹´å¹³æ—¶åŸºæœ¬å¿™è¿™å…¬å¸çš„ä¸œè¥¿

è‡ªå·±æƒ³å†™ä¸€äº›å°é¡¹ç›®,éƒ½æ˜¯å†™äº†ä¸€ç‚¹å°±åºŸå¼ƒäº†

>  æ„Ÿè§‰**å®Œæ•´**çš„é¡¹ç›®å¯¹ä¸ªäººçš„æå‡ä¸å¤§,å› ä¸ºå¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨é€ è½®å­

æ€»çš„æ¥è¯´,è¿™ä¸€å¹´è¿˜æ˜¯åšäº†ä¸€ç‚¹å¾®å°çš„å·¥ä½œ

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/å¹´ç»ˆæ€»ç»“/è´¡çŒ®.jpg)



æœ‰æ‰€æˆé•¿,ä½†æ˜¯ä¹ŸçŸ¥é“è‡ªå·±æ¬ ç¼ºçš„ä¸œè¥¿è¶Šæ¥è¶Šå¤š



![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/å¹´ç»ˆæ€»ç»“/å°å®‰å“.jpeg)



å‰åå¾…äº†ä¸¤ä¸ªå…¬å¸,éƒ½æ˜¯å°è§„æ¨¡çš„åˆ›ä¸šå…¬å¸

è‡³ä»Šéƒ½æ˜¯1ä¸ªäºº(æˆ–è€…2ä¸ªäºº)å¼€å‘é¡¹ç›®,æ„Ÿè§‰ä¸€ç›´éƒ½åœ¨å¾ˆä½æ•ˆå¾ˆä½æ•ˆåœ°å·¥ä½œ

>  æ„Ÿè§‰androidå¼€å‘çœŸæ˜¯è‰°éš¾å•Š,ç›¸æ¯”iOS

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/effort.jpeg)



é™†é™†ç»­ç»­çœ‹è¿‡ä¹Ÿç»ƒæ‰‹è¿‡,MVP,MVVM,MVPVMä¹‹ç±»çš„ä¸œè¥¿

å½“æ—¶å¹¶ä¸èƒ½åˆ‡èº«åœ°æ„Ÿè§‰åˆ°å®ƒä»¬çš„å¥½å¤„,ç°åœ¨æƒ³æƒ³çœŸæ˜¯å›¾æ ·å›¾æ£®ç ´

ç”šè‡³ä»¥å‰æˆ‘éƒ½ä¸æ€ä¹ˆå–œæ¬¢ç”¨`Fragment`,å› ä¸ºå‘ç°`Fragment`å¾ˆéš¾ç®¡ç†

ç°åœ¨æˆ‘å¼€å§‹åœ¨é¡¹ç›®é‡Œé¢å¤§é‡çš„ä½¿ç”¨`Fragment`,å› ä¸ºå¤šæ•°æƒ…å†µä¸‹å®ƒä»¬å¯ä»¥å¤ç”¨,å¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´

> ä¸€ä¸ªäººå¼€å‘å˜›,å¿ƒé‡Œçš„è‹¦åªæœ‰è‡ªå·±çŸ¥é“ğŸ˜
>
> å…¶å®æ˜¯æ‰€æœ‰çš„é”…åªèƒ½ä¸€ä¸ªäººèƒŒå•¦(å“ˆå“ˆ



ä¹Ÿå¼€å§‹ç–¯ç‹‚å°è£…ä¸€äº›åŸºç±»æ¥å¤ç”¨

æ¯”å¦‚ä¸€ä¸ªæ˜¾ç¤ºåˆ—è¡¨çš„`Fragment`åŸºæœ¬å°±æ˜¯ä¼ å…¥ä¸€ä¸ªViewModelå’Œä¸€ä¸ªItemçš„å¸ƒå±€æ–‡ä»¶å°±å¯ä»¥äº†



å³ä¾¿å¦‚æ­¤,è™½ç„¶å¤ç”¨äº†å¤§é‡ä»£ç ,ä½†æ˜¯é™åˆ¶ä¹Ÿè¶Šæ¥è¶Šå¤š

æ¯æ¬¡äº§å“ç»ç†ä¸€å¼€å£,æˆ‘éƒ½æ„Ÿè§‰è‡ªå·±çš„ä»£ç æ˜¯ä¸€æ‘ŠğŸ¶å±



å¯èƒ½æˆ‘èƒ½é€šè¿‡å¾ˆå¥½çš„å°è£…æ¥è§£å†³`Activity`å’Œ`Fragment`è¿‡é‡çš„é—®é¢˜,ä½†æ˜¯é¡¹ç›®è¿˜æ˜¯å¾ˆéš¾ç»´æŠ¤

å°¤å…¶æ˜¯å½“éœ€æ±‚ä¸€ç›´æ”¹å˜,æ–°åŠŸèƒ½ä¸æ–­è¿­ä»£,é¡¹ç›®çš„å†å²è´Ÿæ‹…è¶Šæ¥è¶Šå¤§

>  KPIå‹åŠ›å€’æ˜¯æ²¡ç”¨â€¦æ„Ÿè§‰æˆ‘ä»¬çš„ç”¨æˆ·éƒ½æ˜¯iOSäººç¾¤ğŸ‘…



æ¯éš”ä¸€æ®µæ—¶é—´çœ‹è‡ªå·±çš„ä»£ç ,æˆ‘éƒ½æ„Ÿè§‰æ˜¯åœ¨å±å±±é‡Œé¢ç¿»æ»š...

æ‰€ä»¥V/Påˆ†ç¦»è²Œä¼¼æˆä¸ºäº†ä¸€ç§å¿…éœ€

å°½ç®¡å„ç§æ¶æ„å‰æœŸæ€»æœ‰ä¸€äº›é¢å¤–çš„å·¥ä½œ,ä½†æ˜¯ä¹‹åçš„å¼€å‘ä¼šå˜å¾—å¾ˆè½»æ¾

åœ¨appä½“ç§¯ä¸æ–­å¢å¤§çš„æ—¶å€™,è®©é¡¹ç›®ç»†åˆ†ä¸‹æ¥çš„**codebase**å°½é‡å°



## åˆä¸€ä¸ªå‰è¨€

æœ€è¿‘äº†è§£å¹¶å°è¯•äº†ä¸€ä¸‹cleanæ¶æ„,å‘ç°å®ƒçœŸçš„å¾ˆ**ç»™åŠ›**

å¥½åæ‚”è‡ªå·±æ²¡æœ‰æ—©ç‚¹ç†Ÿæ‚‰å®ƒå¹¶æŠ•å…¥ä½¿ç”¨.

---

**Cleanæ¶æ„**å¯ä»¥ä½¿ä½ çš„ä»£ç æœ‰å¦‚ä¸‹ç‰¹æ€§:

- ç‹¬ç«‹äºæ¶æ„
- æ˜“äºæµ‹è¯•
- ç‹¬ç«‹äºUI
- ç‹¬ç«‹äºæ•°æ®åº“
- ç‹¬ç«‹äºä»»ä½•å¤–éƒ¨ç±»åº“


å¦‚æœä½ è¿˜ä¸äº†è§£**Cleanæ¶æ„**,è‚¯å®šè¦å…ˆå»çœ‹ä¸‹è¿™ä¸ª:

[Uncle Bob](https://8thlight.com/blog/uncle-bob/)çš„[The Clean Architecture](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html)



è¿™é‡Œåªæ˜¯æƒ³è®²è®²è‡ªå·±å…³äº**Cleanæ¶æ„**çš„ä¸€ç‚¹å®è·µ,

æœ‰é—®é¢˜å¤§å®¶ä¸€èµ·æ¢è®¨ä¸‹...

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/dicha.jpg)

## å¼€å§‹

è¯•ç€å†™äº†ä¸€ä¸ªdemo:[**Vincent**](https://github.com/80998062/Vicent)

è™½ç„¶åªå†™äº†ä¸€ç‚¹ç‚¹(ç„¶ååºŸå¼ƒäº†=  =),ä½†æ˜¯**Cleanæ¶æ„**çš„æ ·å­æ„Ÿè§‰æœ‰äº†(æˆ‘æ˜¯è¿™ä¹ˆè§‰å¾—å“ˆå“ˆ

> åˆè¡·æ˜¯å†™ä¸€ä¸ªtubmlræ ·å­çš„weibo, å†™ç€å†™ç€å‘ç°æ¸£æµªå¯¹ç¬¬ä¸‰æ”¾å¼€å‘è€…çš„é™åˆ¶å¤ªå¤šäº†.
>
> å‘ç°æˆä¸ªæƒè¿˜è¦è®¤è¯,è¿˜è¦ç”³è¯·ä¸€ä¸ªè“Vçš„å¾®åšâ€¦æˆ‘æ„Ÿè§‰å¥½éš¾å—



é¦–å…ˆè¿™å¼ å›¾ä½ è‚¯å®šè§è¿‡...

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/chart.jpg)



 å…¶å®æ›´ç›´è§‚çš„,æˆ‘ä»¬ç›´æ¥å°±ç€ä»£ç æ¥çœ‹3ä¸ª**module**ä¹‹é—´çš„ä¾èµ–:

- **data**(æ•°æ®å±‚

```groovy
apply plugin: 'java'
def cfg = rootProject.ext;
dependencies {
    // ReactiveX
    compile cfg.dependencies["rxjava"]
    // Square
    compile cfg.dependencies["retrofit"]
    compile cfg.dependencies["converter-gson"]
    compile cfg.dependencies["adapter-rxjava"]
    compile cfg.dependencies["logging-interceptor"]
    compile cfg.dependencies["dagger"]
}
```



- **usecase**(ç”¨ä¾‹å±‚ å½“ç„¶ä½ å«domainä¹Ÿè¡Œ

```groovy
apply plugin: 'java'
dependencies {
    compile project(':data')
}
```

> **data**å’Œ**usecase**å±‚éƒ½åº”è¯¥æ˜¯javaä»£ç ,è·Ÿ**Android Framework**æ— å…³

- **app**(å°±æ˜¯æˆ‘ä»¬å¹³æ—¶å†™çš„é‚£ä¸ªapp

```groovy
  dependencies {
        compile fileTree(include: ['*.jar'], dir: 'libs')
        // skip
        compile project(':usecase')
  }
```

ç„¶åä½ ä»¬æ„Ÿå—ä¸€ä¸‹:

- ç”¨ä¾‹å±‚ä»æ•°æ®å±‚è·å–æ•°æ®
- åœ¨ç”¨ä¾‹é‡Œé¢è¿›è¡Œå¤„ç†ä¸šåŠ¡é€»è¾‘(è™½ç„¶æˆ‘å‘ç°ä¸€èˆ¬çš„é¡¹ç›®æ ¹æœ¬æ²¡æœ‰ä»€ä¹ˆä¸šåŠ¡é€»è¾‘å¯è¨€
- è§†å›¾å±‚ä»ç”¨ä¾‹å±‚è·å–æ•°æ®ç„¶åæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š


---

## Standing

> ç„¶åè®²ä¸€ä¸‹å„ç§ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿



**dataå±‚**

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/dataå±‚.jpg)



**entities:**

 å®ä½“ç±»(æœ€åŸå§‹çš„æ•°æ®,ä¸è¯¥éšç€ä¸šåŠ¡é€»è¾‘è€Œæ”¹å˜



**wrapper:**

å¯¹å®ä½“ç±»çš„ä¸€å±‚å°è£…,åœ¨è¿™é‡Œä½ å¯èƒ½è¦è‡ªå·±åŠ ä¸€äº›ä¸œè¥¿:æ¯”å¦‚:

- å¤„ç†timestamp,è½¬æ¢è¾“å‡ºæœ¬åœ°æ—¶é—´
- ä¸€äº›é¢å¤–çš„å‚æ•°,æ¯”å¦‚æ•°æ®è¾¹ç•Œçš„éªŒè¯ç­‰ç­‰

> å½“ç„¶è¿™äº›ä½ ä¹Ÿå¯ä»¥æ”¾åœ¨Viewå±‚çš„ViewModelé‡Œé¢
>
> ä½†æ˜¯æ„Ÿè§‰æ”¾è¿™é‡Œæ¯”è¾ƒæ¸…æ™°

**remote:**

é¡¾åæ€ä¹‰å˜›,è¿™å°±æ˜¯RemoteDataSource,åœ¨è¿™é‡Œé…ç½®å’Œå°è£…äº†(å¯¹äºæˆ‘æ¥è¯´)`OkHttp`å’Œ`Retrofit`çš„æ¥å£

**utils:**

- è‡ªå®šä¹‰äº†ä¸€äº›`transformer`,æ¯”å¦‚åˆ‡æ¢çº¿ç¨‹å’Œå…¨å±€çš„é”™è¯¯å¤„ç†
- ç½‘ç»œè¯·æ±‚çš„`Interceptor`
- å…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„




å½“æ—¶è¿™æ ·å†™äº†æˆ‘å°±æ„Ÿè§‰ç‰¹åˆ«é…·ç‚«(è¯´å‡ºæ¥åˆ«ç¬‘æˆ‘...

å› ä¸ºå¯ä»¥åœ¨è¿™é‡Œç›´æ¥ç”¨ä¸€ä¸ªjavaç±»æ¥æµ‹è¯•api,è€Œä¸æ˜¯ç¼–è¯‘æ•´ä¸ªé¡¹ç›®...

ä¸å¯¹ä¸å¯¹,æ˜¯API...æœ‰ä¸€æ¬¡æˆ‘ä»¬çš„pythonè¿‡æ¥è¯´ä½ Apiè¿™ä¸ªç±»åº”è¯¥å…¨å¤§å†™...

> æ¯æ¬¡å«æˆ‘ä»¬pythonè¿‡æ¥çœ‹logcatçš„æ—¶å€™ = = ä»–éƒ½ä¼šåœ¨æ—è¾¹å‘ç‰¢éªš: å®‰å“ç¼–è¯‘æ€ä¹ˆä¼šè¿™ä¹ˆæ…¢....
>
> å§æ§½æˆ‘ä¹Ÿä¸æƒ³å•Š

å½“ç„¶ä½ ä¼šè¯´ç”¨**Postman**ä¸å°±å¥½äº†...

ä½†æ˜¯è¿™æ ·èƒ½æœ‰ä¸€ä¸ªé…ç½®äº†`OkHttp`å’Œ`Retrofit`çš„ç¯å¢ƒå˜›...



---

**usecaseå±‚**

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/usecaseå±‚.jpg)



> ç”¨ä¾‹å±‚å°±æ¯”è¾ƒç®€å•äº†...å› ä¸ºä¸€èˆ¬çš„åº”ç”¨éƒ½æ²¡æœ‰ä»€ä¹ˆä¸šåŠ¡é€»è¾‘



ä¸¾ä¸ªğŸŒ°

æˆ‘è¦ä»ä¸€ä¸ªä»serverç«¯è·å–å¾®åš(status)æ˜¾ç¤ºåˆ°timelineåˆ—è¡¨ä¸Š

é¦–å…ˆæˆ‘æœ‰ä¸€ä¸ª`Usecase`çš„æ¥å£è¦ç»§æ‰¿(`<T>`æ˜¯ç½‘ç»œè¯·æ±‚è¿”å›çš„æ•°æ®ç±»å‹

```java
public abstract class Usecase<T> {
    protected abstract Observable<T> buildObservable();
}
```

å…·ä½“ä»£ç :

```java
public class GetTimelineUsecase extends Usecase<Timeline> {
    private final RemoteRepository mRepository;
    private final SchedulerTransformer<Timeline> mSchedulerTransformer;
    private int page = 1;
    @Named("uid")
    private long uid;
    @Named("timeline_type")
    private String timeline_type;

    @Inject
    GetTimelineUsecase(RemoteRepository repository,
                       @Named("io_main") SchedulerTransformer schedulerTransformer,
                       @Named("timeline_type") String timeline_type,
                       @Named("uid") long uid) {
        mRepository = repository;
        mSchedulerTransformer = schedulerTransformer;
        this.uid = uid;
        this.timeline_type = timeline_type;
    }
}
```

åœ¨æ„é€ å‡½æ•°é‡Œé¢æˆ‘ä»¬æ³¨å…¥äº†:

- æ ¹æ®é¡µé¢é€»è¾‘ç›¸å…³çš„å‚æ•°(`timeline_type`,`uid`)

- è·Ÿ**Android Framework**ç›¸å…³çš„ä¸œè¥¿(æ¯”å¦‚` AndroidSchedulers.mainThread()`

  > å› ä¸ºè¿™ä¸€å±‚æ˜¯`apply plugin: 'java'`å˜›~


ç„¶åæˆ‘éœ€è¦æœ‰:

- RemoteRepository(æº,è¿”å›æ•°æ®

- SchedulerTransformer(åˆ‡æ¢çº¿ç¨‹,æ¯”å¦‚IOå’ŒUIçº¿ç¨‹ä¹‹é—´

  > è¿™é‡Œæˆ‘ç›´æ¥æ³¨å…¥ä¸€ä¸ªtransformer...å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ³¨å…¥ä¸åŒçš„`thread`

  â€‹


- timeline_type,uid(æ¥å£çš„å‚æ•°

  > é’ˆå¯¹è¿”å›ç›¸åŒæ•°æ®ç±»å‹çš„æ¥å£ æˆ‘ä»¬å¯ä»¥å°è£…åœ¨ä¸€ä¸ªç”¨ä¾‹é‡Œé¢




æˆ‘åœ¨`buildObservable()`ä¸­æ ¹æ®`timeline_type`å’Œ`uid`è¯·æ±‚ä¸åŒçš„æ¥å£:

```java
   @Override
    protected Observable<Timeline> buildObservable() {
        switch (timeline_type) {
            case "home_timeline":
                return mRepository.home_timeline(page, feature)
                        .compose(mSchedulerTransformer);
            case "friends_timeline":
         	    skip;
            default:
                return Observable.error(new Throwable("Timeline type can't be null!"));
        }
```

ç„¶ååœ¨`GetTimelineUsecase`ä¸­ä¼šæœ‰ä¸€ä¸ª`excute()`æ–¹æ³•,æˆ‘åœ¨è¿™é‡Œå¤„ç†ä¸šåŠ¡é€»è¾‘:

```java
public Observable<Timeline> excute(final boolean refresh) {
    return buildObservable()
            .doOnSubscribe(new Action0() {
                @Override
                public void call() {
                    if (refresh) {
                        page = 1;
                    }
                }
            })
            .doOnNext(new Action1<Timeline>() {
                @Override
                public void call(Timeline timeline) {
                    if (0 != timeline.getNextCursor()) {
                        ++page;
                    }
                }
            });
}
```

ç„¶åä½ ä¼šé—®ä¸šåŠ¡é€»è¾‘åœ¨å“ªé‡Œ(é»‘äººé—®å·???

æˆ‘å°±è¯´å˜›,ä¸€èˆ¬çš„é¡¹ç›®æ²¡ä»€ä¹ˆä¸šåŠ¡é€»è¾‘....

è¿™é‡Œä¸æ˜¯æœ‰ä¸€ç‚¹ç‚¹å¤„ç†åˆ†é¡µçš„é€»è¾‘(å°±è¿™ä¹ˆå¤šäº†

æ‰€ä»¥Viewå±‚(æˆ–è€…è¯´æ˜¯ä½ çš„Presenter)ä¸ç”¨å†å…³å¿ƒåˆ†é¡µ,ä¸ç”¨æœ‰ä»€ä¹ˆpageæˆ–è€…cursor

åªè¦åœ¨é‚£è¾¹ä¸€ç›´è°ƒç”¨`excute()`å°±å¥½äº†,æƒ³åˆ°ä¸€ä¸ªViewå±‚çš„è®¾è®¡åŸåˆ™

> è®©Viewå°½å¯èƒ½çš„ç¬¨æ‹™å’Œè¢«åŠ¨

è™½ç„¶ä¼šä¼ è¿‡æ¥ä¸€ä¸ª`refresh`çš„`Boolean`å€¼å“ˆ,ä½†æ˜¯å¯ä»¥è®¤ä¸ºè¿™åªæ˜¯ç”¨æˆ·æ“ä½œ(é¡µé¢é€»è¾‘),å’Œä¸šåŠ¡é€»è¾‘æ— å…³.

**PS:**

åœ¨è¿™é‡Œè¿˜è‡ªå®šä¹‰äº†ä¸€ä¸ªæ³¨è§£

```java
@Documented
@Retention(CLASS)
@Target({METHOD, PARAMETER, FIELD})
public @interface Nullable {
}
```

>  å› ä¸ºè¿™ä¸ªmoduleæ²¡æœ‰`support-annotation`å¯ä»¥ç”¨

**Dagger**ä¼šè¦æ±‚å¦‚æœä½ æ³¨å…¥çš„å‚æ•°æ˜¯`null`,å°±å¿…é¡»ç”¨`@Nullable`æ³¨è§£,ä¸ç„¶å°±ä¼šæŠ¥é”™.

åœ¨ä¸€äº›åœ°æ–¹æˆ‘éœ€è¦ç”¨åˆ°å®ƒ,æ¥ä¼ å…¥ä¸€äº›é»˜è®¤å€¼(æ¯”å¦‚nullå’Œ0,å› ä¸ºå¯èƒ½è¿™ä¸ªè¯·æ±‚å‚æ•°ç”¨ä¸åˆ°

å¦å¤–,åœ¨æ³¨å…¥`String` `Long`ç­‰ç±»å‹çš„å‚æ•°çš„æ—¶å€™,éœ€è¦ç”¨`@Name`æ³¨è§£,ä¸ç„¶ç¼–è¯‘å™¨è‚¯å®šä¸çŸ¥é“ä½ éœ€è¦çš„æ˜¯ä»€ä¹ˆ



---

**Viewå±‚**

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/appå±‚.jpg)

Viewå±‚å…¶å®æ²¡ä»€ä¹ˆå¥½è®²çš„,å°±æ˜¯Databinding+Dagger+MVP

**Dagger:**

å–œæ¬¢ç”¨**Dagger**çš„åŸå› æ˜¯å› ä¸ºå®ƒèƒ½è¿«ä½¿æˆ‘ç†æ¸…æ‰€æœ‰çš„ä¾èµ–å…³ç³»

è‡³äºæ³¨å…¥æœ¬èº«æ„Ÿè§‰ä¹Ÿæ²¡æœ‰é‚£ä¹ˆæ–¹ä¾¿,æ¯•ç«Ÿå¤šäº†å¾ˆå¤šå‰æœŸå·¥ä½œ...

å…³äº**Dagger**çš„ä½¿ç”¨,ä¹Ÿæ˜¯çœ‹äº†å¾ˆå¤šæ–‡ç« æ‰æ‹æ¸…æ¥šçš„

æ¨èä¸€ä¸‹[frogermcsçš„åšå®¢](http://frogermcs.github.io/)~

**MVP:**

åŸºæœ¬ä¸Šæ˜¯ç…§ç€Googleçš„[android-architecture](https://github.com/googlesamples/android-architecture)å†™å‡ºæ¥çš„

æœ‰å¾ˆå¤šåˆ†æçš„ä¸é”™çš„æ–‡ç« ,æˆ‘ä¹Ÿæ˜¯çœ‹äº†å¥½ä¹…æ‰ææ¸…æ¥šçš„

æ¯”å¦‚[**CameloeAnthony**](http://www.jianshu.com/users/44872eaffa8b/latest_articles)åœ¨ç®€ä¹¦ä¸Šçš„é‚£ä¸ªç³»åˆ—~

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/dicha.jpg)

è¿™é‡Œå°±ä¸å±•å¼€äº†â€¦

**EventBus:**

é¡¹ç›®é‡Œçš„äº‹ä»¶æ€»çº¿ç”¨çš„æ˜¯Eventbus.

ä¸è¿‡æ¸æ¸å‘ç°ä»£ç é‡ä¸€ä¸Šå»,å„ç§eventå°±ä¼šä½¿é€»è¾‘å˜å¾—å¾ˆæ··ä¹±

>  ä¸çŸ¥é“Eventbusçš„æ­£ç¡®æ‰“å¼€æ–¹å¼åˆ°åº•æ˜¯ä»€ä¹ˆ?

ç°åœ¨æˆ‘åæ­£æ˜¯å°½é‡å°‘ç”¨...



**DataBinding**

å…¶å®ç”¨äº†ä¹‹åæ„Ÿè§‰æ²¡æœ‰ä¸€å¼€å§‹é‚£ä¹ˆé…·ç‚«å•¦

åŒå‘ç»‘å®šä»€ä¹ˆçš„,å®é™…ä½¿ç”¨åœºæ™¯å¾ˆå°‘...

è€Œä¸”Cleanç»“æ„å†³å®šäº†Viewå’ŒçœŸæ­£çš„Modelåªä¼šæ˜¯å•å‘çš„ç»‘å®š

>  ä½†æ˜¯å¦‚æœä½ è¿˜æ²¡ç”¨è¿‡DataBinding,èµ¶ç´§å°è¯•ä¸€ä¸‹å§

å…¶å®Googleçš„æ–‡æ¡£å†™çš„ä¸æ˜¯å¾ˆå…¨é¢,å†™çš„æœ€å¥½çš„æ„Ÿè§‰è¿˜æ˜¯å¤§å¸…çš„[åšå®¢](http://blog.zhaiyifan.cn/)

![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/dicha.jpg)



**ViewModel:**

æ—¢ç„¶æ˜¯å•å‘ç»‘å®š,ViewModelæ‰®æ¼”çš„è§’è‰²å°±åªæ˜¯

- æš´éœ²å‡ºéœ€è¦çš„properties
- è®©Viewå®ç°å®ƒçš„æ¥å£

å½“ç„¶å…³äºViewModelçš„å†™æ³•,è®²é“ç†åº”è¯¥æ˜¯å¯¹dataå±‚çš„modelçš„ä¸€æ¬¡æ˜ å°„,

ä½†æ˜¯æ„Ÿè§‰è¿™æ ·è¦ç”¨æ‰‹æ‰“å¥½å¤šä»£ç ...å¦‚æœASæœ‰æ’ä»¶(ç±»ä¼¼GsonFormatä¹‹ç±»çš„)æˆ‘å¯èƒ½ä¼šè¿™æ ·å†™...

æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬ç›´æ¥`extends`æˆ–è€…`wrap`æŸä¸ªmodelå°±å¥½äº†â€¦å†è°ƒç”¨`getter`æ–¹æ³•è·å¾—properties



**Tips**

å…¶å®ç”¨ViewModelçš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°è£…ä¸€äº›æ–¹æ³•.

æ¯”å¦‚**å›¾ç‰‡åŠ è½½åº“**,ä½ å¯èƒ½ä¼šè§‰å¾—å›¾ç‰‡åŠ è½½åº“è¿˜è¦å°è£…,ä¸æ˜¯åªè¦ä¸€å¥è¯:

```java
load(url).into(imageView);
```

å¯¹å•Š,ä½†æ˜¯å¯èƒ½ä½ å› ä¸º**Glide**çš„æ–¹æ³•æ•°å¤ªå¤š,è¦æ¢æˆ**Picasso**

>  è¿™ä¸‹ä¸å°±éº»çƒ¦äº†

ä½†æ˜¯å½“ä½ æŠŠæ‰€æœ‰å›¾ç‰‡åŠ è½½çš„åœºæ™¯(ä¸€èˆ¬çš„...)éƒ½å†™åœ¨`@BindingAdapter`é‡Œé¢

ä¸¾ä¸ªğŸŒ°:

```java
    @BindingAdapter("avatar")
    public static void loadAvatar(ImageView view, String url) {
        Glide.with(view.getContext()).load(url).into(view);
    }

    @BindingAdapter("photo")
    public static void loadPhoto(ImageView view, String uri) {
        Glide.with(view.getContext()).load(Uri.parse(uri)).into(view);
    }
```

è¿™æ ·åˆ°æ—¶å€™å…¨å±€æ„ä¹‰ä¸Šçš„æ›¿æ¢ä¸€ä¸ªåº“å°±å¾ˆæ–¹ä¾¿äº†

**Rxjava**

ç”¨`Subscriber`æ¥ä»£æ›¿`Callback`,åœ¨Presenteré‡Œé¢å°±å…¨éƒ¨éƒ½æ˜¯ä»ä¸Šå¾€ä¸‹çš„Rxçš„stream

ä¸¾ä¸ªğŸŒ°,ä¸€ä¸ªåˆ—è¡¨åŠ è½½æ•°æ®:

```java
	public void loadMore() {
        if (dataInTransit || reachBottom) return;
        mSubscriptions.add(mUsecase.execute(false) // boolean: needRefresh
                .doOnSubscribe(() -> dataInTransit = true)
                .doOnTerminate(() -> dataInTransit = false)
                .doOnSubscribe(mView::startLoading)
                .doOnTerminate(mView::stopLoading)
                .doOnError(mView::showError)
                .subscribe(timeline -> {
                    if (timeline.getNextCursor() == 0) {
                        reachBottom = true;
                        mView.showNoMore();
                    } else {
                        mView.setData(timeline.getStatuses(), false);
                    }
                }));
    }
```

å†™èµ·æ¥ç‰¹åˆ«èˆ’æœ~

å…³äºRxJava,å“åº”å¼ç¼–ç¨‹ä»€ä¹ˆçš„å·²ç»ä¸æ˜¯ä¸€ä¸ªæ–°é²œç©æ„å„¿,åœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†

> å®‰åˆ©ä¸€ä¸‹

æ„Ÿè§‰**Github**ä¸Šçš„[**Awesome-RxJava**](https://github.com/lzyzsd/Awesome-RxJava)åˆ—å‡ºçš„ä¸€äº›èµ„æ–™éƒ½éå¸¸ä¸é”™~



## æœ€å

å…¶ä»–è¿˜æœ‰ä¸€äº›ä¸œè¥¿...ä¹‹åå†è¡¥ä¸Šäº†

æ€»ä¹‹,**Cleanæ¶æ„**æ˜¯ä¸ªè›®æœ‰æ„æ€ç„¶åå¾ˆå®ç”¨çš„ä¸œè¥¿

å¤§å®¶æœ‰æ—¶é—´å¯ä»¥äº†è§£ä¸€ä¸‹~

æœ€å,Everybody æ–°å¹´å¿«ä¹ğŸ‰ğŸ‰ğŸ‰ æ–°çš„ä¸€å¹´é‡Œéƒ½èƒ½æˆä¸ºæ›´å¥½çš„è‡ªå·±~



![image](https://github.com/80998062/80998062.github.io/raw/master/img/in-post/clear-architecture/jiaban.png)
